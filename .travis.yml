language: c
sudo: required
branches:
  except:
    - master

services:
  - docker

before_install:
  - docker pull ocaml/opam2:alpine
  - docker run -td --name installer_builder -v $(pwd):/home/opam/llsh-master ocaml/opam2:alpine
  - docker exec installer_builder sudo apk add m4
  - docker exec installer_builder opam install dune
  - docker exec installer_builder opam install core_kernel
  - docker exec installer_builder opam install fileutils
  - docker exec installer_builder opam install ppx_sexp_conv
  - docker exec installer_builder opam install re
  - docker exec installer_builder opam install sexplib

script:
  - docker exec installer_builder bash -c 'cd ~; ls'
  - docker exec installer_builder bash -c 'cp -r ~/llsh-master ~/llsh'
  - docker exec installer_builder bash -c 'chmod u=rwx ~/llsh'
  - docker exec installer_builder bash -c 'eval $(opam env); cd ~/llsh/installer_ml; make'

deploy:
  api_key:
    secure: 

notifications:
  email:
    on_success: never
